<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="utf-8">
	<meta name="format-detection" content="telephone=no">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
	<title>DEMO</title>
	<!--css-->
	<link href="/static/css/style.min.css" rel="stylesheet" media="all">
	<!-- Favicons -->
	<link rel="icon" href="/static/img/favicon.png" type="image/vnd.microsoft.icon">

	<script src="jquery.min.js" type="text/javascript"></script>

	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	<script src="https://www.chartjs.org/dist/2.8.0/Chart.min.js"></script>
	<!-- jQuery library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

	<!-- Latest compiled JavaScript -->
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

	<script>
		var line_chart;
		var chart_config;

		function chartjs() {
			chart_config = {
				type: 'line',
				data: {
				labels: ["January", "Feb"],
				datasets: [{
					label: "Temperature",
					data: [65, 66],
					backgroundColor: ['rgba(221, 199, 167, .4)'],
					borderColor: ['rgba(221, 199, 167, 0.9)'],
					yAxisID: 'y-axis-1',
				}, {
					label: "Humidity",
					data: [28, 21],
					backgroundColor: ['rgba(154, 196, 159, .8)'],
					borderColor: ['rgba(154, 196, 159, .9)'],
					yAxisID: 'y-axis-2',
				}]
				},
				options: {
				responsive: true,
				legend: {
					display: false
				},
				tooltips: {
					mode: 'index',
					intersect: false,
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				scales: {
					yAxes: [{
					type: 'linear',
					display: true,
					position: 'left',
					id: 'y-axis-1',
					}, {
					type: 'linear',
					display: true,
					position: 'right',
					id: 'y-axis-2',

					gridLines: {
						drawOnChartArea: false,
					},
					}],
				}
				}
			}

			let context = document.getElementById("line_chart").getContext('2d');
			line_chart = new Chart(context, chart_config);
		}

		function updateInfo() {
			$("#my_form").submit(function(event){
				event.preventDefault(); //prevent default action 
				var post_url = $(this).attr("action"); //get form action url
				var request_method = $(this).attr("method"); //get form GET/POST method
				
				var form_data = $(this).serializeArray(); //Encode form elements for submissiondataContainer.textContent = JSON.stringify(data, null, "  ");
				
				$.ajax({
					url : post_url,
					type: request_method,
					data : form_data
				}).done(function(data){ //
					let d = JSON.stringify(data);
					d = JSON.parse(d);
					//console.log(json.data.info.name);
					var time = [], pp = [], heart_rate = [];
					if(d.data.chart_data != '') 
					{
						d.data.chart_data.forEach(element => {
							time.push(element.time);
							pp.push(element.pp);
							heart_rate.push(element.heart_rate);
						});
					}
					
					if(d.data.chart_data != undefined && d.data.info != undefined) {
						
						chart_config.data.labels = time;
      					chart_config.data.datasets[0].data = pp;
      					chart_config.data.datasets[1].data = heart_rate;
						line_chart.update();
						  
						//update infor
						$("#patient_name").val(d.data.info.name+'');
						$("#guess").val(d.data.info.doctor_guess+'');
						$("#treat_method").val(d.data.info.treat_method+'');
					}
					else {
						
						alert("Người này ra viện rồi!");
						$("#error").val(data.error + '');
					}
				});
			});
		}

		$(document).ready(function () {
			chartjs();
			updateInfo();
		});
	</script>

</head>
<body id="top" class='top'>
	<main id="wrap" class="wrap">
		<div class="sidebar">
			<a href="" class="item item--01 active"><p>DASHBOARD</p></a>
			<a href="/doctor/input" class="item item--02"><p>THÊM BỆNH NHÂN</p></a>
			<a href="/doctor/search" class="item item--03"><p>TRA CỨU THÔNG TIN<br>BỆNH NHÂN</p></a>
			<a href="/doctor/add_date_out" class="item item--04"><p>CẬP NHẬT<br>NGÀY RA VIỆN</p></a>
			<a href="/device" class="item item--05"><p>QUẢN LÝ THIẾT BỊ</p></a>
			<div class="item"></div>
			<div class="item"></div>
		</div>
		<div class="main">
			<div class="nav">
				<div class="nav__name">
					<div class="img">
						<img src="/static/img/user.png" alt="dd">
					</div>
					<p class="name"><%= data.name %></p>
				</div>
				<div class="nav__btn"><a href="/doctor/signout">LOGOUT</a></div>
			</div>
			<div class="form form2">
				<form method="POST" action="/doctor/search" id="my_form">
					<div class="form2__top">
						<div class="row">
							<div class=" col col1">
								<p class="row__ttl">Mã bệnh nhân:</p>
								<input type="text" name="patient_id">
							</div>
							<div class="col col2">
								
								<p class="row__ttl pad" id='error'><%= data.error %></p>
								
								<p class="row__ttl pad">Họ tên bệnh nhân:</p>
								<input type="text" name='patient_name'>
							</div>
							<input class="btn" type="submit" value='TÌM KIẾM'/>
						</div>
					</div>
				</form>
				
				<div class="form2__chart">
				<div style="width:90%;">
					<div class="chartjs-size-monitor">
						<div class="chartjs-size-monitor-expand">
							<div class=""></div>
						</div>
						<div class="chartjs-size-monitor-shrink">
							<div class=""></div>
						</div>
					</div>
					<canvas id="line_chart" style="display: block; width: 772px; height: 386px;" width="772" height="386"
						class="chartjs-render-monitor"></canvas>
				</div>

				<!-- THÔNG TIN BÁC SĨ -->
				<div class="form2__bot">
					<p class="form__ttl mar"><em>THÔNG TIN BỆNH NHÂN</em></p>
					<div class="row">
						<div class=" col col9">
							<p class="row__ttl">Họ tên người bệnh:</p>
							<input type="text" class="area" id="patient_name">
						</div>	
						<div class=" col col10">
							<p class="row__ttl pad">Tuổi</p>
							<input type="text" id="patient_age">
						</div>					
					</div>
					<div class="row">
						<div class=" col col8">
							<p class="row__ttl">Chẩn đoán:</p>
							<input type="text" class="area" id="guess">
						</div>					
					</div>
					<div class="row">
						<div class=" col col8">
							<p class="row__ttl">Phương pháp điều trị:</p>
							<input type="text" class="area" id="treat_method">
						</div>					
					</div>
					<div class="row">
						<div class=" col col8">
							<p class="row__ttl">Lời dặn của bác sĩ:</p>
							<input type="text" class="area" id="doctor_advice>
						</div>					
					</div>
				</div>
			</div>
		</div>
	</main>
</body>
</html> 